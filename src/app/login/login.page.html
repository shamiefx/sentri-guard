<ion-content class="auth-content ion-padding" fullscreen>
  <div class="brand fade-in">
    <h1>Sentri Guard</h1>
    <p class="tagline">Secure Attendance</p>
  </div>

  <div class="auth-card pop-in" [class.blur]="loading()">
    <form [formGroup]="form" (ngSubmit)="submit()" novalidate>
      <!-- Email -->
      <div class="field" [class.is-invalid]="f.email.touched && f.email.invalid">
        <label class="sr-only" for="email">Email</label>
        <div class="input-wrap">
          <ion-icon name="mail-outline" aria-hidden="true"></ion-icon>
          <ion-input
            id="email"
            type="email"
            inputmode="email"
            formControlName="email"
            autocomplete="off"
            autocapitalize="off"
            autocorrect="off"
            spellcheck="false"
            placeholder="you@company.com"
            [clearInput]="true"
            [debounce]="150">
          </ion-input>
        </div>
        <ion-note color="danger" *ngIf="f.email.touched && f.email.invalid">
          Valid email required
        </ion-note>
      </div>

      <!-- Password -->
      <div class="field" [class.is-invalid]="f.password.touched && f.password.invalid">
        <label class="sr-only" for="password">Password</label>
        <div class="input-wrap">
          <ion-icon name="lock-closed-outline" aria-hidden="true"></ion-icon>
          <ion-input
            id="password"
            [type]="showPwd ? 'text' : 'password'"
            formControlName="password"
            autocomplete="off"
            autocapitalize="off"
            autocorrect="off"
            spellcheck="false"
            placeholder="Your password"
            enterkeyhint="done">
          </ion-input>

          <ion-button
            fill="clear"
            size="small"
            type="button"
            class="icon-button"
            (click)="togglePwd()"
            [attr.aria-pressed]="showPwd"
            [attr.aria-label]="showPwd ? 'Hide password' : 'Show password'">
            <ion-icon [name]="showPwd ? 'eye-off-outline' : 'eye-outline'"></ion-icon>
          </ion-button>
        </div>
        <ion-note color="danger" *ngIf="f.password.touched && f.password.invalid">
          Min 6 characters
        </ion-note>
      </div>

      <!-- Actions -->
      <div class="actions">
        <ion-button
          class="primary-btn"
          type="submit"
          expand="block"
          [disabled]="loading() || form.invalid">
          @if (!loading()) { Login } @else { <ion-spinner name="crescent" aria-label="Signing in"></ion-spinner> }
        </ion-button>

        <div class="links">
          <button type="button" class="link-btn" (click)="goToRegister()">Create account</button>
          <button type="button" class="link-btn" (click)="goToReset()">Forgot password?</button>
        </div>
      </div>
    </form>
  </div>

  <!-- Toast for errors / status -->
  <ion-toast
    [isOpen]="toastOpen()"
    (didDismiss)="toastOpen.set(false)"
    [message]="toastMsg()"
    duration="2800"
    position="bottom"
    color="danger"
    icon="alert-circle-outline">
  </ion-toast>

  <!-- Lightweight loading scrim -->
  @if (loading()) {
    <div class="scrim" aria-hidden="true">
      <ion-spinner name="crescent"></ion-spinner>
    </div>
  }
</ion-content>
